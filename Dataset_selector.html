<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>SST Select</title>
<style>
  :root{
    --bg:#ffffff;
    --text:#111;
    --muted:#69707a;
    --grid-gap:8px;
    --row-h:30px;
    --bar-h:10px;
    --bar-r:0px;
    --bgbar:#e9ecef;
    --dim:0.7;
    --marker-dim:0.1;
    --legend-muted:#444;
  }
  html,body{height:100%}
  body{margin:0;background:var(--bg);color:var(--text);font:14px/1.4 system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif}
  .wrap{max-width:1280px;margin:18px auto;padding:0 14px}
  h1{font:600 18px/1.2 system-ui;margin:0 0 12px}
  .controls{display:flex;flex-wrap:nowrap;gap:10px;margin:8px 0 14px;white-space:nowrap;}
  .control{display:flex;align-items:center;gap:6px}
  .control label{font-size:12px; font-weight: 600;}
  input[type="search"]{padding:6px 8px;border:1px solid #ddd;border-radius:8px}
  select{padding:6px 8px;border:1px solid #ddd;border-radius:8px;background:#fff}
  select:focus {
    outline: none;              /* remove default outline */
    border-color: #8d8d8d;         /* custom border */
    background-color: #ffffff;  /* custom background */
    color: #3d3d3d;                /* custom text color */
  }

  a.ref-link {
    font-size: 12px;     /* text size */
    color: #848484;      /* link color */
    text-decoration: underline;
  }

  a.ref-link:hover,
  a.ref-link:focus { color: #5c5c5c; }   /* optional */
  a.ref-link:visited { color: #848484; } /* optional */

  /* ==== main grid (8 columns) ==== */
  .grid{
    display:grid;
    grid-template-columns: 9% 9% 4% 4% 4% 30% 2% 6%;
    column-gap:var(--grid-gap);
    row-gap:0px;
    align-items:center;
    overflow:visible;
  }
  .hdr{font-weight:600;color:#333}
  .row{height:var(--row-h);display:contents}
  .cell{align-self:center;overflow:visible}
  .name a{font-weight:700;text-decoration:none;white-space:nowrap}
  .icons{display:flex;gap:6px;align-items:center}
  .icons img{height:18px;width:auto;object-fit:contain;display:block}
  .mono{font-variant-numeric:tabular-nums}
  .ens{white-space:nowrap}
  .upd{white-space:nowrap}
  .tl{position:relative;height:var(--row-h);display:flex;align-items:center}
  .tlsvg{width:100%;height:100%;overflow:visible}
  .bgbar{fill:var(--bgbar)}
  .actbar{stroke:none}
  .gap{fill:none;stroke-width:1.5;stroke-dasharray:2 1.5}
  .marker{cursor:pointer}
  .mtext{
    font:700 14px/1.0 ui-monospace,Consolas,monospace;
    dominant-baseline:central;
    text-anchor:middle;
    fill:#000;
    stroke:none;
  }
  .pubTri{cursor:pointer}

  .axis {
    border: none;
    margin: 0;
    height: 28px;
    line-height: 0;   /* remove baseline gap */
    padding-top: 0pt;   /* only top */
    padding-bottom: 0;   /* no bottom */
  }

  .axsvg {
    display: block;   /* stop inline-svg baseline spacing */
    height: 100%;
    width: 100%;
  }
  /* replace the old .tick text rule */
  .axis text.tick {
    font-size: 13px;                 /* set size */
    font-family: ui-monospace, Consolas, monospace;
    fill: #333;
  }
  .tick line{stroke:#bbb}
  .dim{opacity:var(--dim)}
  .row.dim > .cell{opacity:var(--dim)}
  .not-soa{filter:grayscale(1) opacity(0.75);opacity:0.6}

  /* ==== legend aligned to the same 7-column grid ==== */
  .legend{
    display:grid;
    grid-template-columns: 9% 9% 4% 4% 4% 30% 2% 6%;
    column-gap:var(--grid-gap);
    align-items:center;
    margin-top:10px;
    color:var(--legend-muted);
  }
  .legend .lg{display:contents}
  .legend .label{grid-column:1 / span 5; white-space:nowrap; overflow:visible}
  .legsvg{grid-column:6; height:14px; width:100%; overflow:visible; display:block; margin-left:0}
  .legline{stroke:#000;stroke-width:2}
  /* style only the circle; do not stroke text */
  .legmark circle{fill:#fff;stroke:#000;stroke-width:2}
  .legend .mtext{fill:#000;stroke:none}

  /* link-icons cell */
  .links{display:flex;align-items:center;gap:8px}
  .linkicon{width:18px;height:18px;display:inline-block}
  .linkicon img{width:100%;height:100%;display:block}
  .linkicon[aria-disabled="true"]{opacity:.05;pointer-events:none}

  .tip{position:fixed;pointer-events:none;background:#111;color:#fff;padding:6px 8px;border-radius:6px;font-size:12px;opacity:0;transition:opacity .12s}
  body[data-hover-code] .marker{opacity:var(--marker-dim)}
  body[data-hover-code] .marker[data-code]{opacity:var(--marker-dim)}
  body[data-hover-code] .marker[data-code].active-code{opacity:1}

  /* dim all legend rows when a code is hovered */
  body[data-hover-code] .legend .label,
  body[data-hover-code] .legend .legsvg { opacity: var(--dim); }

  /* undim only the matching legend row */
  body[data-hover-code] .legend .lg.active-code .label,
  body[data-hover-code] .legend .lg.active-code .legsvg { opacity: 1; }

  hr {margin:10px 0;   /* thin spacing around rule */}

  hr.dashed {
    border: none;                 /* remove default */
    border-top: 2px solid #4444446a;  /* dashed rule */
    margin: 0;                    /* control spacing */
  }

  .tl-scroll{ overflow-x:auto; }
  .tl-content{ min-width:300px; }  /* prevents shrink; enables sideways scroll */
  .grid, .legend, .axis{ min-width:300px; }  /* match the same min */

.instructions {
  color:#777;
  font-size:9pt;
  margin:0;
  line-height:1.2;
}

.instructions .line {
  display:block;       /* force each item onto its own line */
  margin-left:35px;   /* indent all continuation lines */
}

.instructions .line.first {
  margin-left:0;       /* first line stays flush */
}

</style>

</head>
<body>
<div class="wrap">
  <h1>Select SST Products for Your Purpose!</h1>

  <div class="tl-scroll">
  <div class="controls">
    <div class="control">
      <label>State-of-the-art</label>
      <select id="flt-soa">
        <option value="any" selected>Not required</option>
        <option value="yes">Yes</option>
      </select>
    </div>
    <div class="control">
      <label>Temporal ≥</label>
      <select id="flt-temporal">
        <option value="Monthly" selected>Monthly</option>
        <option value="Weekly">Weekly</option>
        <option value="Daily">Daily</option>
      </select>
    </div>
    <div class="control">
      <label>Spatial ° ≤</label>
      <select id="flt-spatial">
        <option value="5" selected>5°</option>
        <option value="2">2°</option>
        <option value="1">1°</option>
        <option value="0.25">0.25°</option>
        <option value="0.05">0.05°</option>
      </select>
    </div>
    <div class="control">
      <label>Infilled</label>
      <select id="flt-complete">
        <option value="any" selected>Not required</option>
        <option value="yes">Yes</option>
      </select>
    </div>
    <div class="control">
      <label>Update (↻) ≥</label>
      <select id="flt-update">
        <option value="any" selected>--</option>
        <option value="static">Static</option>
        <option value="annually">Annually</option>
        <option value="monthly">Monthly</option>
      </select>
    </div>
  </div>

  <hr>

  <div class="grid hdr" id="hdr">
    <div class="cell name">Dataset</div>
    <div class="cell">Input</div>
    <div class="cell">Reso</div>
    <div class="cell">Infilled</div>
    <div class="cell">&nbsp En</div>
    <div class="cell">Timeline <span style="color:#777; font-weight: normal;">(▼: publication year)</span></div>
    <div class="cell">↻</div>
    <div class="cell">Guide</div> <!-- new -->
  </div>

  <div class="grid" id="rows"></div>

  <div class="axis"><svg class="axsvg"></svg></div>
  <hr class="dashed">

  <!-- Legend uses same grid. Text spans columns 1–5. SVG sits in column 6. -->
  <div class="legend" id="legend">
    <div class="lg" data-code="C"><span class="label"><b>C</b>old canvas bucket bias
      <a href="https://www.nature.com/articles/s41586-024-08230-1" class="ref-link">(Sippel et al., 2024</a>,
      <a href="https://doi.org/10.1029/2025GL116615" class="ref-link">Chan et al., 2025)</a></span><svg class="legsvg"></svg></div>
    <div class="lg" data-code="I"><span class="label"><b>I</b>nter-source inhomogeneity
      <a href="https://doi.org/10.1038/s41586-019-1349-2" class="ref-link">(Chan et al., 2019)</a></span><svg class="legsvg"></svg></div>
    <div class="lg" data-code="W"><span class="label">World War 2 <b>W</b>arm Anomaly
      <a href="https://doi.org/10.1038/nature06982" class="ref-link">(Thompson et al., 2009</a>,
      <a href="https://doi.org/10.1175/JCLI-D-20-0907.1" class="ref-link">Chan & Huybers, 2021)</a></span><svg class="legsvg"></svg></div>
    <div class="lg" data-code="O"><span class="label">Ship-buoy <b>O</b>ffsets
      <a href="https://doi.org/10.1126/science.aaa5632" class="ref-link">(Karl et al., 2015)</a></span><svg class="legsvg"></svg></div>
    <div class="lg" data-code="T"><span class="label"><b>T</b>rend outlier in the satellite era
      <a href="https://doi.org/10.1038/s41558-025-02362-6" class="ref-link">(Menemenlis et al., 2025)</a></span><svg class="legsvg"></svg></div>
    <!--<div class="lg" data-code="?"><span class="label" style="color:#ff0000"><b>Need to Check!</b></span><svg class="legsvg"></svg></div> -->
  </div>

  <hr>

  <p class="instructions">
    <span class="line first"><b>Click</b>: Dataset Name → Data Producer’s Page</span>
    <span class="line">▼ &nbsp → Reference Page</span>
    
    <span class="line">
      <span class="icon" style="color:#777; vertical-align:middle;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14">
            <path d="M12 4 C9 3,6 3,4 5 v14 c2-2,5-2,8-1 z" fill="currentColor"/>
            <path d="M12 4 C15 3,18 3,20 5 v14 c-2-2-5-2-8-1 z" fill="currentColor"/>
            <line x1="12" y1="4" x2="12" y2="20" stroke="white" stroke-width="1.5"/>
            <line x1="6" y1="7" x2="10" y2="7" stroke="white" stroke-width="1"/>
            <line x1="6" y1="10.5" x2="10" y2="10.5" stroke="white" stroke-width="1"/>
            <line x1="6" y1="14" x2="10" y2="14" stroke="white" stroke-width="1"/>
            <line x1="14" y1="7" x2="18" y2="7" stroke="white" stroke-width="1"/>
            <line x1="14" y1="10.5" x2="18" y2="10.5" stroke="white" stroke-width="1"/>
            <line x1="14" y1="14" x2="18" y2="14" stroke="white" stroke-width="1"/>
          </svg>
      </span> → NCAR Climate Data Guide
    </span>

    <span class="line">
      <span class="icon" style="color:#777; vertical-align:middle;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14">
          <path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" fill="currentColor"/>
          <line x1="9" y1="2" x2="9" y2="22" stroke="white" stroke-width="2"/>
          <line x1="14" y1="6" x2="18" y2="6" stroke="white" stroke-width="1.5" opacity="0.5"/>
          <line x1="14" y1="10" x2="18" y2="10" stroke="white" stroke-width="1.5" opacity="0.5"/>
          <line x1="14" y1="14" x2="18" y2="14" stroke="white" stroke-width="1.5" opacity="0.5"/>
        </svg>
      </span> → Product User Guide
    </span>
    <span class="line">
      <span class="icon" style="color:#777; vertical-align:middle;">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="14" height="14">
            <path d="M12 3v10" stroke="currentColor" stroke-width="3" fill="none"/>
            <path d="M8 11l4 4 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
            <path d="M4 19h16v2H4z" fill="currentColor"/>
          </svg>
      </span> → Download Page
    </span>
  </p>

  </div>
</div>

<div class="tip" id="tip"></div>

<script type="application/json" id="data">
[
  {"id":"dcsst","name":"DCSST","pub_year":2024,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"5°","spatial_complete":false,"ensemble":200,
   "start":1850,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#D62728","state_of_the_art":true,"update_frequency":"Annually",
   "url":"https://duochanatharvard.github.io/#DCENT",
   "pub_url":"https://doi.org/10.1038/s41597-024-03742-x",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/dcent",
   "download_url":"https://doi.org/10.7910/DVN/NU4UGW"},

  {"id":"dcssti","name":"DCSST-I","pub_year":2025,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"5°","spatial_complete":true,"ensemble":200,
   "start":1850,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#D62728","state_of_the_art":true,"update_frequency":"Annually",
   "url":"https://duochanatharvard.github.io/#DCENT",
   "pub_url":"https://doi.org/10.31223/X5V16S",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/dcent",
   "download_url":"https://doi.org/10.7910/DVN/ROG38Q"},

  {"id":"hadsst42","name":"HadSST4.2","pub_year":2025,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"5°","spatial_complete":false,"ensemble":200,
   "start":1850,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#fb7915","state_of_the_art":true,"update_frequency":"Monthly",
   "url":"https://www.metoffice.gov.uk/hadobs/hadsst4/",
   "pub_url":"https://doi.org/10.1029/2018JD029867",
   "user_guide_url": "https://www.metoffice.gov.uk/hadobs/hadsst4/documentation/HadSST.4.2.0.0_product_user_guide.pdf",
   "download_url":"https://www.metoffice.gov.uk/hadobs/hadsst4/data/download.html",
   "markers":[{"year":1910,"code":"C"}]},

  {"id":"hadsst4","name":"HadSST4.0","pub_year":2019,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"5°","spatial_complete":false,"ensemble":200,
   "start":1850,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"Monthly",
   "url":"https://www.metoffice.gov.uk/hadobs/hadsst4/",
   "pub_url":"https://doi.org/10.1029/2018JD029867",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-hadsst4",
   "user_guide_url": "https://hadleyserver.metoffice.gov.uk/hadsst4/documentation/HadSST.4.0.1.0_product_user_guide.pdf",
   "download_url":"https://www.metoffice.gov.uk/hadobs/hadsst4/HadSST.4.0.1.0_data/HadSST.4.0.1.0_download.html",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"}]},

  {"id":"hadsst3","name":"HadSST3","pub_year":2012,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"5°","spatial_complete":false,"ensemble":100,
   "start":1850,"end":2022,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"--",
   "url":"https://www.metoffice.gov.uk/hadobs/hadsst3/",
   "pub_url":"https://doi.org/10.1029/2010JD015220",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-hadsst3",
   "download_url":"https://www.metoffice.gov.uk/hadobs/hadsst3/data/download.html",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"}]},

  {"id":"hadsst2","name":"HadSST2","pub_year":2006,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"5°","spatial_complete":false,"ensemble":1,
   "start":1850,"end":2014,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"--",
   "url":"https://www.metoffice.gov.uk/hadobs/hadsst2/",
   "pub_url":"https://doi.org/10.1175/JCLI3637.1",
   "download_url":"https://www.metoffice.gov.uk/hadobs/hadsst2/data/download.html",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"}]},

  {"id":"ersst6","name":"ERSST6","pub_year":2025,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"2°","spatial_complete":true,"ensemble":"1",
   "start":1850,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#ceb619","state_of_the_art":true,"update_frequency":"Monthly",
   "url":"https://www.ncei.noaa.gov/products/extended-reconstructed-sst",
   "pub_url":"https://doi.org/10.1175/JCLI-D-23-0707.1",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-noaa-extended-reconstruction-ssts-version-6-ersstv6",
   "download_url":"https://www.ncei.noaa.gov/data/sea-surface-temperature-extended-reconstructed/v6/access/",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"}]},

  {"id":"ersst5","name":"ERSST5","pub_year":2017,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"2°","spatial_complete":true,"ensemble":1000,
   "start":1854,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"Monthly",
   "url":"https://www.ncei.noaa.gov/products/extended-reconstructed-sst",
   "pub_url":"https://doi.org/10.1175/JCLI-D-16-0836.1",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-noaa-extended-reconstruction-ssts-version-5-ersstv5",
   "download_url":"https://www.ncei.noaa.gov/pub/data/cmb/ersst/v5/netcdf/",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"}]},

  {"id":"ersst4","name":"ERSST4","pub_year":2015,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"2°","spatial_complete":true,"ensemble":1000,
   "start":1854,"end":2020,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"M",
   "url":"https://www.ncei.noaa.gov/products/extended-reconstructed-sst",
   "pub_url":"https://doi.org/10.1175/JCLI-D-14-00006.1",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-noaa-extended-reconstruction-ssts-version-4",
   "download_url":"https://www.ncei.noaa.gov/pub/data/cmb/ersst/v4/netcdf/",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"}]},

  {"id":"ersst3","name":"ERSST3b","pub_year":2009,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"2°","spatial_complete":true,"ensemble":1,
   "start":1854,"end":2020,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"M",
   "url":"https://www.ncei.noaa.gov/products/extended-reconstructed-sst",
   "pub_url":"https://doi.org/10.1175/2007JCLI2100.1",
   "download_url":"https://www.ncei.noaa.gov/pub/data/cmb/ersst/v3b/netcdf/",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"},{"year":2006,"code":"O"},{"year":2014,"code":"T"}]},

  {"id":"cobesst3","name":"COBE-SST3","pub_year":2025,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Daily","spatial":"0.25°","spatial_complete":true,"ensemble":300,
   "start":1850,"end":2020,"bg_start":1850,"bg_end":"present",
   "color":"#35971a","state_of_the_art":true,"update_frequency":"Static",
   "url":"https://metsoc.jp/jmsj/GA/JMSJ2025-002.pdf",
   "pub_url":"https://doi.org/10.2151/jmsj.2025-002",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-cobev3-centennial-situ-observation-based-estimates-version-3",
   "download_url":"https://climate.mri-jma.go.jp/pub/archives/Ishii-et-al_COBE-SST3/",
   "markers":[{"year":1910,"code":"C"}]},

  {"id":"cobesst2","name":"COBE-SST2","pub_year":2014,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"1°","spatial_complete":true,"ensemble":1,
   "start":1850,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"Monthly",
   "url":"https://ds.data.jma.go.jp/tcc/tcc/products/elnino/cobesst2_doc.html",
   "pub_url":"https://doi.org/10.1175/JCLI-D-12-00837.1",
   "download_url":"https://downloads.psl.noaa.gov/Datasets/COBE2/",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"}]},

  {"id":"cobesst","name":"COBE-SST","pub_year":2005,
   "icons":{"ship":true,"buoy":true,"sat":false},
   "temporal":"Monthly","spatial":"1°","spatial_complete":true,"ensemble":1,
   "start":1891,"end":2023,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"--",
   "url":"https://ds.data.jma.go.jp/tcc/tcc/products/elnino/cobesst_doc.html",
   "pub_url":"https://doi.org/10.1002/joc.1169",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-cobe-centennial-situ-observation-based-estimates",
   "download_url":"https://downloads.psl.noaa.gov/Datasets/COBE/",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"},{"year":2006,"code":"O"},{"year":2014,"code":"T"}]},

  {"id":"hadisst","name":"HadISST1","pub_year":2003,
   "icons":{"ship":true,"buoy":true,"sat":true},
   "temporal":"Monthly","spatial":"1°","spatial_complete":true,"ensemble":1,
   "start":1870,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#1a9786","state_of_the_art":true,"update_frequency":"Monthly",
   "url":"https://www.metoffice.gov.uk/hadobs/hadisst/index.html",
   "pub_url":"https://doi.org/10.1029/2002JD002670",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-hadisst-v11",
   "download_url":"https://www.metoffice.gov.uk/hadobs/hadisst/data/download.html",
   "markers":[{"year":1910,"code":"C"},{"year":1930,"code":"I"},{"year":1942,"code":"W"},{"year":2006,"code":"O"},{"year":2014,"code":"T"}]},

  {"id":"cobesst3h","name":"COBE-SST3H","pub_year":2025,
   "icons":{"ship":true,"buoy":true,"sat":true},
   "temporal":"Daily","spatial":"0.25°","spatial_complete":true,"ensemble":1,
   "start":1981,"end":2020,"bg_start":1850,"bg_end":"present",
   "color":"#3C64B3","state_of_the_art":true,"update_frequency":"Static",
   "url":"https://metsoc.jp/jmsj/GA/JMSJ2025-002.pdf",
   "pub_url":"https://doi.org/10.2151/jmsj.2025-002",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-cobev3-centennial-situ-observation-based-estimates-version-3",
   "download_url":"https://climate.mri-jma.go.jp/pub/archives/Ishii-et-al_COBE-SST3/"},

  {"id":"oisst21","name":"OISSTv2.1","pub_year":2021,
   "icons":{"ship":true,"buoy":true,"sat":true},
   "temporal":"Daily","spatial":"0.25°","spatial_complete":true,"ensemble":1,
   "start":1981,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#0b3bea","state_of_the_art":true,"update_frequency":"Monthly",
   "url":"https://www.ncei.noaa.gov/products/optimum-interpolation-sst",
   "pub_url":"https://doi.org/10.1175/JCLI-D-20-0166.1",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-noaa-daily-optimum-interpolation-sea-surface-temperature-version-21-oisstv21",
   "download_url":"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2.1/access/avhrr/",
   "markers":[{"year":2014,"code":"T"}]},

  {"id":"oisst2","name":"OISSTv2","pub_year":2007,
   "icons":{"ship":true,"buoy":true,"sat":true},
   "temporal":"Daily","spatial":"0.25°","spatial_complete":true,"ensemble":1,
   "start":1981,"end":2020,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"--",
   "url":"https://www.ncei.noaa.gov/products/optimum-interpolation-sst",
   "pub_url":"https://doi.org/10.1175/2007JCLI1824.1",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-noaa-high-resolution-025x025-blended-analysis-daily-sst-and-ice-oisstv2",
   "download_url":"https://www.ncei.noaa.gov/data/sea-surface-temperature-optimum-interpolation/v2/access/amsr-avhrr/",
   "markers":[{"year":2014,"code":"T"}]},

  {"id":"oisst22","name":"OISSTv2","pub_year":2002,
   "icons":{"ship":true,"buoy":true,"sat":true},
   "temporal":"Weekly","spatial":"1°","spatial_complete":true,"ensemble":1,
   "start":1981,"end":2007,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"--",
   "url":"https://www.ncei.noaa.gov/products/optimum-interpolation-sst",
   "guide_url":"https://climatedataguide.ucar.edu/climate-data/sst-data-noaa-optimal-interpolation-oi-sst-analysis-version-2-oisstv2-1x1",
   "pub_url":"https://doi.org/10.1175/1520-0442(2002)015%3C1609:AIISAS%3E2.0.CO;2"},

  {"id":"oisst","name":"OISSTv1","pub_year":1994,
   "icons":{"ship":true,"buoy":true,"sat":true},
   "temporal":"Weekly","spatial":"1°","spatial_complete":true,"ensemble":1,
   "start":1981,"end":2002,"bg_start":1850,"bg_end":"present",
   "color":"#a9a9a9","state_of_the_art":false,"update_frequency":"--",
   "url":"https://www.ncei.noaa.gov/products/optimum-interpolation-sst",
   "pub_url":"https://doi.org/10.1175/1520-0442(1994)007%3C0929:IGSSTA%3E2.0.CO;2"},

  {"id":"ccisst","name":"ESA-CCI SST3.0","pub_year":2024,
   "icons":{"ship":false,"buoy":false,"sat":true},
   "temporal":"Daily","spatial":"0.05°","spatial_complete":true,"ensemble":1,
   "start":1980,"end":"present","bg_start":1850,"bg_end":"present",
   "color":"#860bea","state_of_the_art":true,"update_frequency":"Monthly",
   "url":"https://climate.esa.int/en/projects/sea-surface-temperature/",
   "pub_url":"https://doi.org/10.1038/s41597-024-03147-w",
   "user_guide_url":"https://climate.esa.int/documents/2568/SST_CCI_D4.2_PUG_v1.1.pdf",
   "download_url":"https://doi.org/10.5285/4a9654136a7148e39b7feb56f8bb02d2"}
]
</script>

<script>
/* ===== utilities ===== */
const $ = (q, el=document)=>el.querySelector(q);
const $$ = (q, el=document)=>[...el.querySelectorAll(q)];
const now = new Date();
const CURR_YEAR = now.getFullYear();
const CURR_DECADE = Math.ceil(CURR_YEAR/10)*10;
const BREAK_YEAR = 1850;
const POST_WEIGHT = 1;
const ICONS = {
  ship_img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="30" height="20" viewBox="0 0 32 20"><polygon points="4,14 28,14 25,18 7,18" fill="%23000"/><rect x="10" y="9" width="12" height="5" fill="%23444"/><rect x="12" y="6" width="8" height="3" fill="%23666"/><rect x="14.5" y="3" width="3" height="3" fill="%23000"/></svg>',
  buoy_img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"><!-- 水波：蓝色弧线 --><path d="M2 18 q3 -3 6 0 t6 0 t6 0" fill="none" stroke="%2300bbff" stroke-width="1.4" stroke-linecap="round"/><path d="M2 21 q3 -3 6 0 t6 0 t6 0" fill="none" stroke="%2300bbff" stroke-width="1.4" stroke-linecap="round"/><circle cx="12" cy="16" r="5.5" fill="%23000"/><rect x="11.5" y="8" width="1" height="8" fill="%23000"/><circle cx="12" cy="12" r="3" fill="%23444"/><circle cx="12" cy="6.5" r="1.3" fill="%23fff" stroke="%23000" stroke-width="1"/></svg>',
  sat_img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" viewBox="0 0 32 32"><!-- 左侧太阳能板 --><rect x="1" y="6" width="4" height="20" fill="%23000"/><rect x="7" y="6" width="2" height="20" fill="%23000"/><!-- 右侧太阳能板 --><rect x="23" y="6" width="2" height="20" fill="%23000"/><rect x="27" y="6" width="4" height="20" fill="%23000"/><!-- 中心主体 --><rect x="13" y="10" width="6" height="12" fill="%23000"/><!-- 上下延伸部分 --><rect x="15" y="3" width="2" height="7" fill="%23000"/><rect x="15" y="22" width="2" height="7" fill="%23000"/><!-- 横向连接线 --><rect x="7" y="15" width="18" height="2" fill="%23000"/></svg>',
  guide_img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M4 5a2 2 0 0 1 2-2h12v16H8a2 2 0 0 0-2 2H4z" fill="%23000"/><path d="M8 5h8v2H8zm0 4h8v2H8zm0 4h6v2H8z" fill="%23fff"/></svg>',
  download_img:'data:image/svg+xml;utf8,<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24"><path d="M12 3v10" stroke="%23000" stroke-width="2"/><path d="M8 11l4 4 4-4" fill="none" stroke="%23000" stroke-width="2"/><path d="M4 19h16v2H4z" fill="%23000"/></svg>'
};

const guideSVG = `
<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <!-- left page -->
  <path d="M12 4 C9 3,6 3,4 5 v14 c2-2,5-2,8-1 z" fill="currentColor"/>
  <!-- right page -->
  <path d="M12 4 C15 3,18 3,20 5 v14 c-2-2-5-2-8-1 z" fill="currentColor"/>
  <!-- spine line -->
  <line x1="12" y1="4" x2="12" y2="20" stroke="white" stroke-width="1.5"/>
  <!-- page lines on left -->
  <line x1="6" y1="7" x2="10" y2="7" stroke="white" stroke-width="1"/>
  <line x1="6" y1="10.5" x2="10" y2="10.5" stroke="white" stroke-width="1"/>
  <line x1="6" y1="14" x2="10" y2="14" stroke="white" stroke-width="1"/>
  <!-- page lines on right -->
  <line x1="14" y1="7" x2="18" y2="7" stroke="white" stroke-width="1"/>
  <line x1="14" y1="10.5" x2="18" y2="10.5" stroke="white" stroke-width="1"/>
  <line x1="14" y1="14" x2="18" y2="14" stroke="white" stroke-width="1"/>
</svg>`;

const guideSVG2 = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path d="M12 3v10" stroke="currentColor" stroke-width="3" fill="none"/>
  <path d="M8 11l4 4 4-4" stroke="currentColor" stroke-width="2" fill="none"/>
  <path d="M4 19h16v2H4z" fill="currentColor"/>
</svg>`;

const guideSVG3 = `<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
  <path d="M6 2h12a2 2 0 0 1 2 2v16a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2z" fill="currentColor"/>
  <line x1="9" y1="2" x2="9" y2="22" stroke="white" stroke-width="2"/>
  <line x1="14" y1="6" x2="18" y2="6" stroke="white" stroke-width="1.5" opacity="0.5"/>
  <line x1="14" y1="10" x2="18" y2="10" stroke="white" stroke-width="1.5" opacity="0.5"/>
  <line x1="14" y1="14" x2="18" y2="14" stroke="white" stroke-width="1.5" opacity="0.5"/>
</svg>`;

const TEMP_RANK = { 'Monthly':1, 'Weekly':2, 'Daily':3 };
const UPD_RANK = {'any': 0, '--': 0, 'static': 1, 'annually': 2, 'monthly': 3};
function spatialToNum(s){ return parseFloat(String(s).replace('°','')); }

/* ===== scale ===== */
function buildScale(width, min=1850, br=BREAK_YEAR, max=CURR_DECADE, r=POST_WEIGHT){
  const pre = br - min;
  const post = max - br;
  const s = width / (pre + r*post);
  const preW = pre*s;
  function yearToX(y){
    if(y<=min) return 0;
    if(y>=max) return width;
    if(y<=br) return (y-min)*s;
    return preW + (y-br)*r*s;
  }
  return {yearToX,preW};
}

/* ===== state ===== */
let DATA = JSON.parse(document.getElementById('data').textContent);
function coerceYears(row){
  const e = row.end==='present'||row.end===null?CURR_YEAR:row.end;
  const be = row.bg_end==='present'||row.bg_end===null?CURR_YEAR:row.bg_end;
  return {...row, end_current:e, bg_end_current:be};
}
DATA = DATA.map(coerceYears);

/* ===== rendering ===== */
const rowsEl = document.getElementById('rows');
const axisSvg = $('.axsvg');
let tlWidth = 0, tlLeft = 0, scale = null;

function measureTlMetrics(){
  const tmp = document.createElement('div');
  tmp.className = 'row';
  for(let i=0;i<8;i++){
    const c = document.createElement('div');
    c.className = 'cell';
    tmp.appendChild(c);
  }
  rowsEl.appendChild(tmp);
  const tlCell = tmp.children[5];
  const rect = tlCell.getBoundingClientRect();
  const gridRect = rowsEl.getBoundingClientRect();
  const w = rect.width;
  const left = rect.left - gridRect.left;
  rowsEl.removeChild(tmp);
  return {w:left<0?w:left>gridRect.width?w: w, left: Math.max(0, Math.min(left, gridRect.width))};
}

function applyAxisSizing(){
  axisSvg.style.width = tlWidth+'px';
  axisSvg.style.marginLeft = tlLeft+'px';
}

function render(){
  const m = measureTlMetrics();
  tlWidth = m.w;
  tlLeft = m.left;
  scale = buildScale(tlWidth);

  applyAxisSizing();
  renderAxis();
  renderRows();
  renderLegend();
  attachLegendHover();
}

function renderAxis(){
  const h = 28;
  axisSvg.setAttribute('viewBox', `0 0 ${tlWidth} ${h}`);
  axisSvg.innerHTML = '';
  const s = buildScale(tlWidth);
  const g = document.createElementNS('http://www.w3.org/2000/svg','g');
  for(let y=1860; y<=CURR_DECADE-10; y+=20){
    const x = s.yearToX(y);
    const line = document.createElementNS('http://www.w3.org/2000/svg','line');
    line.setAttribute('x1',x); line.setAttribute('x2',x);
    line.setAttribute('y1',h-16); line.setAttribute('y2',h-4);
    line.setAttribute('class','tick');
    g.appendChild(line);
    const txt = document.createElementNS('http://www.w3.org/2000/svg','text');
    txt.setAttribute('x',x+2); txt.setAttribute('y',h-18); txt.setAttribute('text-anchor','middle');
    txt.textContent = y;
    txt.setAttribute('class','tick');
    g.appendChild(txt);
  }
  axisSvg.appendChild(g);
}

function mkCell(cls, parent){
  const d = document.createElement('div');
  d.className = 'cell '+cls;
  parent.appendChild(d);
  return d;
}

function renderRows(){
  rowsEl.innerHTML = '';
  const filtered = DATA.filter(applyFilters);
  filtered.forEach(row=>{
    const r = mkRow(row);
    rowsEl.appendChild(r);
  });
  attachHover();
}

function mkRow(row){
  const wrap = document.createElement('div'); wrap.className='row';

  const c1 = mkCell('name', wrap);
  const a = document.createElement('a');
  a.href=row.url; a.textContent=row.name; a.style.color=row.color; a.target="_blank"; a.rel="noopener";
  a.dataset.id=row.id; c1.appendChild(a);

  const c2 = mkCell('icons', wrap);
  ['ship','buoy','sat'].forEach(k=>{
    const img = document.createElement('img');
    const key = k + '_img';
    img.src = (row.icons?.[key] || ICONS[key]);
    img.alt = k;
    if (!row.icons?.[k]) img.style.visibility = 'hidden';  // keeps space, shows nothing
    c2.appendChild(img);
  });

  const c3 = mkCell('res', wrap);
  c3.style.color = row.color; c3.style.fontWeight='700';
  const TEMP_ABBR = {'Monthly':'M','Annually':'A','Annual':'A','Weekly':'W','Daily':'D'};
  const tempAbbr = TEMP_ABBR[row.temporal] || row.temporal;
  c3.textContent = `${tempAbbr}${row.spatial}`;

  const c4 = mkCell('comp', wrap);
  c4.style.color=row.color; c4.style.fontWeight='700'; c4.style.textAlign='center';
  c4.textContent = row.spatial_complete ? '✓' : '✗';

  const c5 = mkCell('ens mono', wrap);
  c5.style.color=row.color; c5.style.fontWeight='700';
  c5.textContent = (row.ensemble==null?'??':row.ensemble);

  const c6 = mkCell('tl', wrap);
  const svg = document.createElementNS('http://www.w3.org/2000/svg','svg');
  svg.classList.add('tlsvg');

  const tlH = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--row-h')) || 36;
  svg.setAttribute('viewBox', `0 0 ${tlWidth} ${tlH}`);

  const bh = parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--bar-h'));
  const cy = tlH/2;
  const barY = cy - bh/2;

  // bars
  const bgx0 = scale.yearToX(row.bg_start);
  const bgx1 = scale.yearToX(row.bg_end_current);
  svg.appendChild(rect(bgx0, barY, bgx1-bgx0, bh, 'bgbar'));

  const ax0 = scale.yearToX(row.start);
  const ax1 = scale.yearToX(row.end_current);
  const act = rect(ax0, barY, Math.max(0, ax1-ax0), bh, 'actbar');
  act.setAttribute('fill', row.color); svg.appendChild(act);

  // decade cut lines confined to the active bar height
  for (let y = 1860; y <= CURR_DECADE; y += 10) {
    const x = scale.yearToX(y);
    const tick = document.createElementNS('http://www.w3.org/2000/svg','line');
    tick.setAttribute('x1', x);
    tick.setAttribute('x2', x);
    tick.setAttribute('y1', barY);           // start at bar top
    tick.setAttribute('y2', barY + bh);      // end at bar bottom
    tick.setAttribute('stroke', getComputedStyle(document.documentElement).getPropertyValue('--bg')); // true “cut”
    tick.setAttribute('stroke-width', 1);
    tick.setAttribute('pointer-events', 'none');
    tick.setAttribute('shape-rendering', 'crispEdges');
    svg.appendChild(tick);
  }

  if(row.pub_year && row.pub_year > row.end_current){
    const gx0 = ax1, gx1 = scale.yearToX(row.pub_year);
    const g = rect(gx0, barY, Math.max(0,gx1-gx0), bh, 'gap');
    g.setAttribute('stroke', row.color); svg.appendChild(g);
  }

  // markers
  (row.markers||[]).forEach(m=>{
    if(m.year<row.start || m.year>Math.max(row.end_current,row.pub_year||row.end_current)) return;
    const cx = scale.yearToX(m.year);
    const group = svgel('g', {'class':'marker','data-code':m.code});
    group.appendChild(svgel('circle',{cx, cy, r:9, fill:'#fff', stroke:'#000', 'stroke-width':2}));
    group.appendChild(svgel('text',{x:cx, y:cy, class:'mtext'}, m.code));
    group.addEventListener('mouseenter', ()=>handleCodeHover(m.code, true));
    group.addEventListener('mouseleave', ()=>handleCodeHover(m.code, false));
    group.addEventListener('mousemove', e=>showTip(e, `${row.name} ● ${m.code} — ${m.year}`));
    group.addEventListener('mouseout', hideTip);
    svg.appendChild(group);
  });

  // publication triangle
  if(row.pub_year){
    const px = scale.yearToX(row.pub_year);
    const tri = svgel('path',{d:`M ${px} ${barY+3} l -5 -10 l 10 0 z`,fill:'#000',class:'pubTri'});
    tri.addEventListener('click', ()=>window.open(row.pub_url,'_blank','noopener'));
    tri.addEventListener('mousemove', e=>showTip(e, `${row.name} ▲ publication — ${row.pub_year}`));
    tri.addEventListener('mouseout', hideTip);
    svg.appendChild(tri);
  }

  c6.appendChild(svg);

  const c7 = mkCell('upd', wrap);
  c7.style.color=row.color; c7.style.fontWeight='700';
  const UPD_ABBR = {'Annually':'A','Annual':'A','Monthly':'M','Static':'S','--':'--'};
  c7.textContent = UPD_ABBR[row.update_frequency] || '--';

  const c8 = mkCell('links', wrap);
  const hasGuide = !!row.guide_url;
  const hasDown  = !!row.download_url;
  c8.appendChild(linkIcon(row.guide_url, 'Data guide', guideSVG, row.color));
  c8.appendChild(linkIcon(row.user_guide_url, 'User Guide', guideSVG3, row.color));
  c8.appendChild(linkIcon(row.download_url, 'Download', guideSVG2, row.color));

  if(!row.state_of_the_art) wrap.classList.add('not-soa');
  wrap.dataset.rowId=row.id;
  return wrap;
}

function linkIcon(href, title, svgMarkup, color){
  const a = document.createElement('a');
  a.className = 'linkicon';
  a.title = title;
    if (href) {
    a.href = href;
    a.target = "_blank";
    a.rel = "noopener";
    a.style.color = color;     // normal colored icon
  } else {
    a.style.color = '#fff';    // make it white (invisible on white bg)
    a.setAttribute('aria-disabled', 'true');
  }
  a.innerHTML = svgMarkup;
  a.style.color = color;       // drives currentColor for both stroke and fill
  return a;
}


function rect(x,y,w,h,cls){
  const el = document.createElementNS('http://www.w3.org/2000/svg','rect');
  el.setAttribute('x',x); el.setAttribute('y',y); el.setAttribute('width',Math.max(0,w)); el.setAttribute('height',h);
  el.setAttribute('rx', parseFloat(getComputedStyle(document.documentElement).getPropertyValue('--bar-r')));
  el.setAttribute('class',cls);
  return el;
}
function svgel(tag, attrs={}, text){
  const ns='http://www.w3.org/2000/svg';
  const e=document.createElementNS(ns, tag);
  Object.entries(attrs).forEach(([k,v])=>e.setAttribute(k,v));
  if(text!=null) e.textContent=text;
  return e;
}

/* ===== legend ranges you control ===== */
const LEGEND_CONFIG = {
  C:  { start: 1890, end: 1955, mid: 1910 },
  I:  { start: 1850, end: 1980, mid: 1930 },
  W:  { start: 1938, end: 1948, mid: 1943 },
  O:  { start: 1980, end: 2025, mid: 2005 },
  T:  { start: 1980, end: 2025, mid: 2013 },
  '?':{ start: 1850, end: 2025 },
};
function getLegendRange(code){
  const cfg = LEGEND_CONFIG[code];
  if(!cfg) return null;
  return { start: cfg.start, end: cfg.end, mid: cfg.mid ?? (cfg.start + cfg.end)/2 };
}

/* ===== legend rendering aligned to column 6 width ===== */
function renderLegend(){
  $$('.legend .lg').forEach(lg=>{
    const code = lg.getAttribute('data-code');
    const svg  = lg.querySelector('.legsvg');
    if(!svg) return;

    const r = getLegendRange(code);
    svg.innerHTML = '';
    if(!r) return;

    const w = svg.getBoundingClientRect().width; // actual width of legend column 6
    const h = 14;
    svg.setAttribute('viewBox', `0 0 ${w} ${h}`);
    const y = h/2;

    const s = buildScale(w); // same scale mechanics as main timeline
    const x0 = s.yearToX(r.start);
    const x1 = s.yearToX(r.end);
    const xm = s.yearToX(r.mid);

    svg.appendChild(svgel('line',{x1:x0,x2:x1,y1:y,y2:y,class:'legline'}));

    const g = svgel('g', {'class':'legmark'});
    g.appendChild(svgel('circle',{cx:xm,cy:y,r:9,class:'legmark'}));
    g.appendChild(svgel('text',{
      x:xm,
      y:y,
      class:'mtext'   // use same styling as dataset markers
    }, code));
    svg.appendChild(g);
  });
}

/* ===== hover logic ===== */
function attachHover(){
  const sel = '.name a, .res, .comp, .ens, .tl, .upd, .links';  // name, infilled, en, timeline bar, update, guide
  $$(sel, rowsEl).forEach(el=>{
    const row = el.closest('.row');
    const id  = row?.dataset.rowId;

    function enter(){
      $$('.row', rowsEl).forEach(r=>{
        r.classList.toggle('dim', r.dataset.rowId !== id);
      });
    }
    function leave(){
      $$('.row', rowsEl).forEach(r=> r.classList.remove('dim'));
    }

    el.addEventListener('mouseenter', enter);
    el.addEventListener('mouseleave', leave);
  });
}

function attachLegendHover(){
  $$('.legend .lg').forEach(lg=>{
    const code = lg.getAttribute('data-code');
    lg.addEventListener('mouseenter', ()=>handleCodeHover(code, true));
    lg.addEventListener('mouseleave', ()=>handleCodeHover(code, false));
  });
}
function handleCodeHover(code, on){
  const body=document.body;
  if(on){
    body.setAttribute('data-hover-code', code);
    $$('.marker', rowsEl).forEach(m=>{
      m.classList.toggle('active-code', m.getAttribute('data-code')===code);
    });
    $$('.legend .lg').forEach(lg=>{
      lg.classList.toggle('active-code', lg.getAttribute('data-code')===code);
    });
  }else{
    body.removeAttribute('data-hover-code');
  }
}

/* ===== tooltips ===== */
const tip = document.getElementById('tip');
function showTip(evt, text){
  tip.textContent = text;
  const pad=10;
  tip.style.left = (evt.clientX+pad)+'px';
  tip.style.top  = (evt.clientY+pad)+'px';
  tip.style.opacity = 1;
}
function hideTip(){ tip.style.opacity = 0; }

/* ===== filters ===== */
function applyFilters(row){
  const tsel = $('#flt-temporal').value;
  if ((TEMP_RANK[row.temporal]||0) < (TEMP_RANK[tsel]||0)) return false;

  const ssel = $('#flt-spatial').value;
  if (spatialToNum(row.spatial) > parseFloat(ssel)) return false;

  const u = $('#flt-update').value;                   // 'any' | 'static' | 'annually' | 'monthly'
  if (u !== 'any') {
    const need = UPD_RANK[u] ?? 0;
    const have = UPD_RANK[(row.update_frequency || '--').toLowerCase()] ?? 0;
    if (have < need) return false;                    // drops “--” when need ≥ static
  }

  const c = $('#flt-complete').value;
  if (c==='yes' && !row.spatial_complete) return false;

  const s = $('#flt-soa').value;
  if (s==='yes' && !row.state_of_the_art) return false;

  return true;
}

['flt-temporal','flt-spatial','flt-update','flt-complete','flt-soa']
  .forEach(id => document.getElementById(id).addEventListener('change', renderRows));

/* ===== init ===== */
window.addEventListener('resize', render);
new ResizeObserver(()=>render()).observe(rowsEl);
render();
</script>
</body>
</html>
